# Описание выполнения дз 6

Для установки postgres была запущена команда:
```sh
$ yum install postgresql-server
```
После этого необходимо запустить postgres и разрешить ему автозапуск. Это можно сделать следующей командой:
```sh
$ sudo systemctl start postgresql
$ sudo systemctl enable postgresql
```
В результате выполнения команды запуска postgres будут созданы файлы конфигурации, которые понадобятся для дальнейшей работы (например, postgresql.conf).
Далее было необходимр выполнить следующие задачи:
- установить размер разделяемой памяти сервера равным 512мб
- установить параметр work_mem равным 32мб
- настроить подключение по порту 6789 со всех ip

Для этого был изменен файл postgresql.conf, ниже приведены параметры, значения которых были изменены:
```sh
shared_buffers = 512MB
work_mem = 32MB
port = 6789
listen_addresses = '*'
```
Также необходимо поменять порт для postgres в /lib/systemd/system/postgresql.service, иначе подключение по-прежнему будет выполняться по дефолтному порту.
Чтобы данные изменения вступили в силу, необходимо перезапустить postgres и systemd. Этого можно добиться путем выполнения команд:
```sh
systemctl daemon-reload
systemctl restart postgresql
```
Теперь необходимо создать пользователя, с помощью которого будет осуществляться доступ к БД и создать БД.
Для создания нового пользователя нужно подключиться в psql через дефолтного пользователя postgres и выполнить скрипт для создания нового пользователя:
```sh
$ sudo -u postgres psql -p 6789
postgres=# CREATE ROLE user28 WITH LOGIN PASSWORD 'password';
```
Чтобы у нового пользователя были права на создание БД, необходимо выполнить еще один скрипт:
```sh
postgres=# ALTER ROLE user28 CREATEDB;
```
Теперь можно войти в psql под новым пользователем и выполнить скрипт для создания новой БД:
```sh
$ psql postgres -U user28 -p 6789
postgres=# CREATE DATABASE shop_data;
```
Чтобы доступ по паролю к созданной БД через пользователя user28 был доступен из приложения, необходимо поменять конфигурационный файл pg_hba.conf.
```sh
# IPv4 local connections:
host    all    all    all    md5
```
Чтобы изменения вступили в силу, необходимо перезапустить postgres, как это было показано ранее.

Поскольку для подключения к БД будет использоваться библиотека psycopg2, необходимо установить ее на сервере. Для этого сначала установим pip и через него выполним установку psycopg2.
```sh
$ sudo yum install python-pip python-wheel
$ python -m pip install psycopg2
```
Для выполнения дальнейшей работы с базой был создан скрипт dz6_postgres.py.